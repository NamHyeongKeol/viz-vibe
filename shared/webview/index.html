<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Viz Vibe</title>
  <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
  <link rel="stylesheet" href="{{stylesUri}}">
</head>
<body>
  <!-- Toolbar -->
  <div class="toolbar">
    <span class="toolbar-title">Viz Vibe <small style="opacity:0.5;font-size:10px;">v2-modular</small></span>
    
    <div class="view-toggle">
      <button id="btnGraphView" class="active" onclick="VizVibeApp.switchView('graph')">üìä Graph</button>
      <button id="btnSourceView" onclick="VizVibeApp.switchView('source')">üìù Source</button>
    </div>
    
    <div class="toolbar-divider"></div>
    
    <button onclick="VizVibeApp.openAddNodeModal('start')" title="Start">+ Start</button>
    <button onclick="VizVibeApp.openAddNodeModal('ai-task')" title="AI Task">+ AI</button>
    <button onclick="VizVibeApp.openAddNodeModal('human-task')" title="Human Task">+ Human</button>
    <button onclick="VizVibeApp.openAddNodeModal('condition')" title="Condition">+ Cond</button>
    <button onclick="VizVibeApp.openAddNodeModal('blocker')" title="Blocker">+ Block</button>
    
    <div class="toolbar-divider"></div>
    
    <select id="flowDirection" onchange="VizVibeApp.changeDirection()" title="Layout direction">
      <option value="TD">‚Üì Top-Down</option>
      <option value="LR">‚Üí Left-Right</option>
      <option value="BT">‚Üë Bottom-Top</option>
      <option value="RL">‚Üê Right-Left</option>
    </select>
    
    <span class="spacer"></span>
    
    <button class="secondary" onclick="VizVibeApp.resetView()" title="Reset view">üéØ Reset</button>
  </div>

  <!-- Main container -->
  <div class="main-container">
    <!-- Graph view -->
    <div id="graph-view">
      <div id="canvas-wrapper">
        <div id="mermaid-container">
          <div id="mermaid-output"></div>
        </div>
      </div>

      <!-- Node info card -->
      <div id="info-card" class="info-card" style="display:none;">
        <button class="close-btn" onclick="VizVibeApp.closeInfoCard()">√ó</button>
        <h4 id="info-label"></h4>
        <p id="info-prompt"></p>
        <button class="copy-btn" onclick="VizVibeApp.copyNodeInfo()">üìã Copy</button>
      </div>

      <!-- Zoom controls -->
      <div class="zoom-controls">
        <button onclick="VizVibeApp.zoomIn()" title="Zoom in">+</button>
        <div class="zoom-level" id="zoomLevel">100%</div>
        <button onclick="VizVibeApp.zoomOut()" title="Zoom out">‚àí</button>
        <button onclick="VizVibeApp.fitToScreen()" title="Fit to screen" style="font-size:12px;">‚äû</button>
      </div>
    </div>

    <!-- Source view -->
    <div id="source-view">
      <textarea id="source-editor" spellcheck="false"></textarea>
    </div>
  </div>

  <!-- Context menu -->
  <div id="context-menu" class="context-menu">
    <div class="context-menu-item" onclick="VizVibeApp.copyNodeId()">Copy Node ID</div>
    <div class="context-menu-item" onclick="VizVibeApp.copyNodeLabel()">Copy Label</div>
    <div class="context-menu-item" onclick="VizVibeApp.copyNodeDescription()">Copy Description</div>
    <div class="context-menu-divider"></div>
    <div class="context-menu-item" onclick="VizVibeApp.copyNodeAll()">Copy All</div>
  </div>

  <!-- Toast notification -->
  <div id="toast" class="toast"></div>

  <!-- Status bar -->
  <div class="status-bar">
    <span><span class="status-dot"></span>Ready</span>
    <span id="nodeCount">Nodes: 0</span>
    <span class="spacer"></span>
    <span class="help-hint">üñ± Drag: Pan ‚Ä¢ Scroll: Zoom ‚Ä¢ Click: Info ‚Ä¢ Right-click: Copy</span>
  </div>

  <!-- Add node modal -->
  <div id="addNodeModal" class="modal-overlay">
    <div class="modal">
      <h3 id="modalTitle">Add New Node</h3>
      <input type="hidden" id="nodeType" />
      <label>Node ID (letters, numbers, _ only)</label>
      <input type="text" id="nodeId" placeholder="e.g. task_login_impl" />
      <label>Label (displayed on graph)</label>
      <input type="text" id="nodeLabel" placeholder="e.g. Login Implementation" />
      <label>Description (details)</label>
      <textarea id="nodePrompt" placeholder="e.g. JWT-based login implementation"></textarea>
      <label>Connect from (optional)</label>
      <select id="connectFrom">
        <option value="">No connection</option>
      </select>
      <div class="modal-buttons">
        <button class="secondary" onclick="VizVibeApp.closeAddNodeModal()">Cancel</button>
        <button onclick="VizVibeApp.confirmAddNode()">Add</button>
      </div>
    </div>
  </div>

  <!-- Scripts -->
  <script src="{{platformUri}}"></script>
  <script src="{{appUri}}"></script>
</body>
</html>

